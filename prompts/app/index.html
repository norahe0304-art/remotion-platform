<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Remotion Prompt Picker</title>
    <style>
      :root {
        --bg: #071124;
        --card: #0d1a32;
        --line: #2c3e6d;
        --text: #ecf2ff;
        --muted: #9eb0dc;
        --accent: #5e8bff;
      }
      * { box-sizing: border-box; }
      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif; background: radial-gradient(900px 500px at 15% 10%, #11325a 0%, transparent 60%), var(--bg); color: var(--text); }
      .wrap { max-width: 1240px; margin: 0 auto; padding: 20px; }
      .hero { border: 1px solid var(--line); border-radius: 16px; padding: 16px; background: rgba(10, 20, 40, .75); margin-bottom: 14px; }
      .hero h1 { margin: 0 0 8px; font-size: 24px; }
      .hero p { margin: 0; color: var(--muted); }
      .steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; margin-top: 14px; }
      .step { border: 1px solid var(--line); border-radius: 12px; padding: 10px; background: #0b1730; }
      .step b { display: block; margin-bottom: 4px; }
      .toolbar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 10px; }
      input, select { background: #121f3d; color: var(--text); border: 1px solid var(--line); border-radius: 10px; padding: 10px 12px; }
      .count { color: var(--muted); font-size: 13px; }
      .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px; }
      .chip { border: 1px solid #4260a4; background: #132345; color: #c2d1f4; border-radius: 999px; padding: 5px 10px; font-size: 12px; cursor: pointer; }
      .chip.active { background: #2a4f9d; color: #fff; border-color: #6f95ea; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); gap: 12px; }
      .card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; padding: 14px; display: flex; flex-direction: column; gap: 8px; }
      .title { font-size: 16px; font-weight: 800; line-height: 1.4; }
      .meta { font-size: 12px; color: var(--muted); }
      .tags { display: flex; flex-wrap: wrap; gap: 6px; }
      .tag { border: 1px solid #3f568f; color: #b8c8ee; font-size: 11px; border-radius: 999px; padding: 3px 8px; }
      .prompt { min-height: 58px; color: #dbe5ff; font-size: 13px; line-height: 1.45; }
      .actions { display: flex; gap: 8px; flex-wrap: wrap; }
      button, a.btn { border: 1px solid #5070b7; background: #193260; color: #eef4ff; border-radius: 10px; font-size: 13px; padding: 8px 10px; cursor: pointer; text-decoration: none; }
      .empty { border: 1px dashed var(--line); border-radius: 12px; color: var(--muted); padding: 18px; background: #0a152a; }
      .modal { position: fixed; inset: 0; background: rgba(2, 7, 16, .75); display: none; align-items: center; justify-content: center; padding: 18px; }
      .modal.open { display: flex; }
      .modal-body { width: min(980px, 96vw); max-height: 92vh; overflow: auto; border: 1px solid var(--line); border-radius: 14px; background: #0b1831; padding: 14px; }
      .modal-head { display: flex; justify-content: space-between; gap: 8px; align-items: center; margin-bottom: 8px; }
      .mono { white-space: pre-wrap; font-family: ui-monospace, Menlo, monospace; font-size: 12px; line-height: 1.5; border: 1px solid #2e4378; border-radius: 12px; background: #0f203f; padding: 12px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <section class="hero">
        <h1>Remotion Prompt Picker</h1>
        <p>Built for non-technical users: filter first, preview, then copy to AI. No coding required.</p>
        <div class="steps">
          <div class="step">
            <b>1. Choose source and style</b>
            Narrow down with source and tags (for example UI Demo or Image Animation).
          </div>
          <div class="step">
            <b>2. Preview the full prompt</b>
            Click Preview to check tone and structure for your project.
          </div>
          <div class="step">
            <b>3. Copy and run</b>
            Copy the text and send it to Codex or Claude Code.
          </div>
        </div>
      </section>

      <div class="toolbar">
        <input id="q" placeholder="Search keywords (for example terminal / product / map)" size="34" />
        <select id="source">
          <option value="">All sources</option>
          <option value="remotion-dev">Official remotion.dev</option>
          <option value="manalkaff">Community manalkaff</option>
        </select>
        <span class="count" id="count"></span>
      </div>
      <div class="chips" id="tagPanel"></div>
      <div id="grid" class="grid"></div>
    </div>

    <div id="modal" class="modal">
      <div class="modal-body">
        <div class="modal-head">
          <strong id="modalTitle"></strong>
          <div class="actions">
            <button id="modalCopy">Copy Prompt</button>
            <button id="modalCopyAi">Copy AI Template</button>
            <a id="modalSource" class="btn" href="#" target="_blank" rel="noreferrer">Open Source</a>
            <button id="modalClose">Close</button>
          </div>
        </div>
        <div id="modalMeta" class="meta"></div>
        <p class="meta">Tip: After copying, add your business goal and asset paths before sending to AI.</p>
        <div id="modalPrompt" class="mono"></div>
      </div>
    </div>

    <script>
      const state = { items: [], q: '', source: '', tag: '' };
      const q = document.getElementById('q');
      const source = document.getElementById('source');
      const tagPanel = document.getElementById('tagPanel');
      const grid = document.getElementById('grid');
      const count = document.getElementById('count');
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalMeta = document.getElementById('modalMeta');
      const modalPrompt = document.getElementById('modalPrompt');
      const modalSource = document.getElementById('modalSource');
      const modalCopy = document.getElementById('modalCopy');
      const modalCopyAi = document.getElementById('modalCopyAi');
      const modalClose = document.getElementById('modalClose');

      const esc = (s = '') => s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
      const sourceOf = (item) => item.id.startsWith('remotion-dev-') ? 'remotion-dev' : item.id.startsWith('manalkaff-') ? 'manalkaff' : 'manual';
      const sourceLabel = (src) => src === 'remotion-dev' ? 'Official' : src === 'manalkaff' ? 'Community' : 'Manual';
      const buildAiTemplate = (item) => {
        return [
          'Please build an executable Remotion implementation plan based on the prompt below.',
          '',
          '[Goal]',
          '- Restate your understanding of the goal in 1-2 sentences.',
          '- If information is missing, ask no more than 3 critical questions.',
          '',
          '[Implementation Requirements]',
          '- Provide a practical scene-by-scene breakdown.',
          '- Recommend key animation and transition choices (readability first).',
          '- Provide an asset checklist (image, audio, font, icon).',
          '- Provide concrete next commands to run.',
          '',
          '[Replaceable Inputs]',
          '- Brand/Theme: <fill here>',
          '- Video Duration: <fill here>',
          '- Target Audience: <fill here>',
          '',
          '[Prompt Title]',
          item.title || '',
          '',
          '[Prompt Text]',
          item.prompt || '',
          '',
          '[Source]',
          item.source_url || '',
        ].join('\n');
      };

      const openModal = (item) => {
        modalTitle.textContent = item.title;
        modalMeta.textContent = `${item.author || 'unknown'} · ${sourceLabel(sourceOf(item))}`;
        modalPrompt.textContent = item.prompt || '';
        modalSource.href = item.source_url || '#';
        modalCopy.onclick = async () => {
          await navigator.clipboard.writeText(item.prompt || '');
          modalCopy.textContent = 'Copied';
          setTimeout(() => (modalCopy.textContent = 'Copy Prompt'), 900);
        };
        modalCopyAi.onclick = async () => {
          await navigator.clipboard.writeText(buildAiTemplate(item));
          modalCopyAi.textContent = 'Copied';
          setTimeout(() => (modalCopyAi.textContent = 'Copy AI Template'), 900);
        };
        modal.classList.add('open');
      };

      const closeModal = () => modal.classList.remove('open');
      modalClose.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

      const renderTags = () => {
        const tagCount = new Map();
        for (const item of state.items) {
          for (const t of item.tags || []) tagCount.set(t, (tagCount.get(t) || 0) + 1);
        }
        const topTags = [...tagCount.entries()].sort((a, b) => b[1] - a[1]).slice(0, 20);
        tagPanel.innerHTML = [
          `<button class="chip ${state.tag ? '' : 'active'}" data-tag="">All tags</button>`,
          ...topTags.map(([tag, n]) => `<button class="chip ${state.tag === tag ? 'active' : ''}" data-tag="${esc(tag)}">${esc(tag)} (${n})</button>`),
        ].join('');
        tagPanel.querySelectorAll('[data-tag]').forEach((el) => {
          el.addEventListener('click', () => {
            state.tag = el.getAttribute('data-tag') || '';
            render();
            renderTags();
          });
        });
      };

      const render = () => {
        const term = state.q.trim().toLowerCase();
        const rows = state.items.filter((item) => {
          const bySource = !state.source || sourceOf(item) === state.source;
          const byTag = !state.tag || (item.tags || []).includes(state.tag);
          const hay = `${item.title} ${(item.tags || []).join(' ')} ${item.prompt}`.toLowerCase();
          const byTerm = !term || hay.includes(term);
          return bySource && byTag && byTerm;
        });

        count.textContent = `Showing ${rows.length} / ${state.items.length}`;
        if (rows.length === 0) {
          grid.innerHTML = `<div class="empty">No matches found. Try clearing tag filters or changing the keyword.</div>`;
          return;
        }

        grid.innerHTML = rows.map((item) => {
          const text = (item.prompt || '').slice(0, 180);
          const preview = text + ((item.prompt || '').length > 180 ? '...' : '');
          return `
            <article class="card">
              <div class="title">${esc(item.title)}</div>
              <div class="meta">${esc(item.author || 'unknown')} · ${sourceLabel(sourceOf(item))}</div>
              <div class="tags">${(item.tags || []).map((t) => `<span class="tag">${esc(t)}</span>`).join('')}</div>
              <div class="prompt">${esc(preview)}</div>
              <div class="actions">
                <button data-preview="${encodeURIComponent(item.id)}">Preview</button>
                <button data-copy="${encodeURIComponent(item.prompt || '')}">Copy</button>
                <button data-copy-ai="${encodeURIComponent(item.id)}">Copy AI Template</button>
                <a class="btn" href="${esc(item.source_url || '#')}" target="_blank" rel="noreferrer">Source</a>
              </div>
            </article>
          `;
        }).join('');

        grid.querySelectorAll('button[data-copy]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const value = decodeURIComponent(btn.getAttribute('data-copy') || '');
            await navigator.clipboard.writeText(value);
            btn.textContent = 'Copied';
            setTimeout(() => (btn.textContent = 'Copy'), 900);
          });
        });

        grid.querySelectorAll('button[data-preview]').forEach((btn) => {
          btn.addEventListener('click', () => {
            const id = decodeURIComponent(btn.getAttribute('data-preview') || '');
            const item = state.items.find((it) => it.id === id);
            if (item) openModal(item);
          });
        });
        grid.querySelectorAll('button[data-copy-ai]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const id = decodeURIComponent(btn.getAttribute('data-copy-ai') || '');
            const item = state.items.find((it) => it.id === id);
            if (!item) return;
            await navigator.clipboard.writeText(buildAiTemplate(item));
            btn.textContent = 'Copied';
            setTimeout(() => (btn.textContent = 'Copy AI Template'), 900);
          });
        });
      };

      q.addEventListener('input', () => { state.q = q.value; render(); });
      source.addEventListener('change', () => { state.source = source.value; render(); });

      fetch('../index.json')
        .then((r) => r.json())
        .then((data) => {
          state.items = data;
          renderTags();
          render();
        })
        .catch((err) => {
          grid.innerHTML = `<div class="empty">Load failed: ${esc(String(err))}</div>`;
        });
    </script>
  </body>
</html>
