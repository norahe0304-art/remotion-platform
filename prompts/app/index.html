<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Prompt Library</title>
    <style>
      :root {
        --bg: #f5f5f7;
        --paper: #ffffff;
        --line: #e5e5ea;
        --text: #1d1d1f;
        --muted: #6e6e73;
        --accent: #fef991;
        --accent-soft: #f2f2f7;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Satoshi Variable", "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", sans-serif;
        background: var(--bg);
        color: var(--text);
      }
      .wrap { max-width: 1120px; margin: 0 auto; padding: 28px 18px 48px; }
      .hero {
        padding: 10px 4px 20px;
        margin-bottom: 8px;
      }
      .hero h1 { margin: 0; font-size: 44px; letter-spacing: -.03em; line-height: 1; font-weight: 650; }
      .hero p { margin: 8px 0 0; color: var(--muted); font-size: 15px; }
      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 10px;
        padding: 12px;
        border: 1px solid #d2d2d7;
        border-radius: 16px;
        background: var(--paper);
        box-shadow: 0 2px 12px rgba(0,0,0,.04);
      }
      input, select {
        background: #fff;
        color: var(--text);
        border: 1px solid #d2d2d7;
        border-radius: 12px;
        padding: 10px 12px;
        font-size: 14px;
      }
      input:focus, select:focus {
        outline: 3px solid rgba(0,113,227,.18);
        border-color: #0071e3;
      }
      .count { color: var(--muted); font-size: 13px; margin-left: auto; }
      .chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 14px; padding: 0; }
      .chip {
        border: 1px solid #d2d2d7;
        background: #fff;
        color: #3a3a3c;
        border-radius: 999px;
        padding: 6px 11px;
        font-size: 12px;
        cursor: pointer;
      }
      .chip.active { background: #1d1d1f; color: #fff; border-color: #1d1d1f; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 12px; }
      .card {
        background: var(--paper);
        border: 1px solid #dedee3;
        border-radius: 18px;
        padding: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: transform .14s ease, box-shadow .14s ease;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 28px rgba(0,0,0,.08);
      }
      .title { font-size: 18px; font-weight: 600; line-height: 1.25; letter-spacing: -.015em; }
      .meta { font-size: 12px; color: var(--muted); }
      .tags { display: flex; flex-wrap: wrap; gap: 6px; }
      .tag { border: 1px solid #e5e5ea; color: #6e6e73; font-size: 11px; border-radius: 999px; padding: 4px 8px; background: #fbfbfd; }
      .prompt { min-height: 44px; color: #3a3a3c; font-size: 13px; line-height: 1.4; }
      .actions { display: flex; gap: 8px; flex-wrap: wrap; }
      button, a.btn {
        border: 1px solid #d2d2d7;
        background: #fff;
        color: #1d1d1f;
        border-radius: 999px;
        font-size: 12px;
        padding: 8px 12px;
        cursor: pointer;
        text-decoration: none;
      }
      button:hover, a.btn:hover { background: var(--accent-soft); }
      button[data-copy-ai], #modalCopyAi {
        background: var(--accent);
        border-color: var(--accent);
        color: #1d1d1f;
      }
      button[data-copy-ai]:hover, #modalCopyAi:hover {
        background: #f7f17a;
        border-color: #f7f17a;
      }
      .empty { border: 1px dashed #d2d2d7; border-radius: 16px; color: var(--muted); padding: 20px; background: #fff; }
      .modal { position: fixed; inset: 0; background: rgba(0,0,0,.24); display: none; align-items: center; justify-content: center; padding: 18px; backdrop-filter: blur(8px); }
      .modal.open { display: flex; }
      .modal-body { width: min(980px, 96vw); max-height: 92vh; overflow: auto; border: 1px solid #d2d2d7; border-radius: 18px; background: #fff; padding: 14px; box-shadow: 0 24px 72px rgba(0,0,0,.15); }
      .modal-head { display: flex; justify-content: space-between; gap: 8px; align-items: center; margin-bottom: 8px; }
      .mono { white-space: pre-wrap; font-family: ui-monospace, Menlo, monospace; font-size: 12px; line-height: 1.5; border: 1px solid #e5e5ea; border-radius: 12px; background: #f7f7f9; padding: 12px; color: #1d1d1f; }
      @media (max-width: 700px) {
        .hero h1 { font-size: 32px; }
        .wrap { padding: 16px 12px 32px; }
        .count { margin-left: 0; }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <section class="hero">
        <h1>Prompt Library</h1>
        <p>Minimal prompt selection for production-ready video generation.</p>
      </section>

      <div class="toolbar">
        <input id="q" placeholder="Search prompts" size="28" />
        <span class="count" id="count"></span>
      </div>
      <div class="chips" id="sourcePanel"></div>
      <div id="grid" class="grid"></div>
    </div>

    <div id="modal" class="modal">
      <div class="modal-body">
        <div class="modal-head">
          <strong id="modalTitle"></strong>
          <div class="actions">
            <button id="modalCopy">Copy</button>
            <button id="modalCopyAi">Copy AI Template</button>
            <a id="modalSource" class="btn" href="#" target="_blank" rel="noreferrer">Open Source</a>
            <button id="modalClose">Close</button>
          </div>
        </div>
        <div id="modalMeta" class="meta"></div>
        <p class="meta">Tip: Add your brand, duration, and audience before sending to AI.</p>
        <div id="modalPrompt" class="mono"></div>
      </div>
    </div>

    <script>
      const state = { items: [], q: '', source: '' };
      const q = document.getElementById('q');
      const sourcePanel = document.getElementById('sourcePanel');
      const grid = document.getElementById('grid');
      const count = document.getElementById('count');
      const modal = document.getElementById('modal');
      const modalTitle = document.getElementById('modalTitle');
      const modalMeta = document.getElementById('modalMeta');
      const modalPrompt = document.getElementById('modalPrompt');
      const modalSource = document.getElementById('modalSource');
      const modalCopy = document.getElementById('modalCopy');
      const modalCopyAi = document.getElementById('modalCopyAi');
      const modalClose = document.getElementById('modalClose');

      const esc = (s = '') => s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
      const sourceOf = (item) => item.id.startsWith('remotion-dev-') ? 'remotion-dev' : item.id.startsWith('manalkaff-') ? 'manalkaff' : 'manual';
      const sourceLabel = (src) => src === 'remotion-dev' ? 'Official' : src === 'manalkaff' ? 'Community' : 'Manual';
      const sourceChoices = [
        { value: '', label: 'All sources' },
        { value: 'remotion-dev', label: 'Official' },
        { value: 'manalkaff', label: 'Community' },
      ];
      const buildBlankTemplate = () => {
        return [
          'Please create a Remotion video plan from scratch using best practices.',
          '',
          '[Goal]',
          '- Restate the goal in 1-2 sentences.',
          '- Ask no more than 3 critical questions if details are missing.',
          '',
          '[Implementation Requirements]',
          '- Propose a practical scene-by-scene structure.',
          '- Suggest transitions/motion style and pacing.',
          '- Provide required assets checklist (logo, image, audio, font, icon).',
          '- Provide concrete next commands to run.',
          '',
          '[Inputs to fill]',
          '- Brand/Theme: <fill here>',
          '- Video Duration: <fill here>',
          '- Target Audience: <fill here>',
          '- Target Channel: <fill here>',
          '- Mandatory Lines: <fill here>',
          '',
          '[Output expected]',
          '- Draft script',
          '- Scene timing map',
          '- Visual direction',
          '- Execution steps',
        ].join('\n');
      };
      const buildAiTemplate = (item) => {
        return [
          'Please build an executable Remotion implementation plan based on the prompt below.',
          '',
          '[Goal]',
          '- Restate your understanding of the goal in 1-2 sentences.',
          '- If information is missing, ask no more than 3 critical questions.',
          '',
          '[Implementation Requirements]',
          '- Provide a practical scene-by-scene breakdown.',
          '- Recommend key animation and transition choices (readability first).',
          '- Provide an asset checklist (image, audio, font, icon).',
          '- Provide concrete next commands to run.',
          '',
          '[Replaceable Inputs]',
          '- Brand/Theme: <fill here>',
          '- Video Duration: <fill here>',
          '- Target Audience: <fill here>',
          '',
          '[Prompt Title]',
          item.title || '',
          '',
          '[Prompt Text]',
          item.prompt || '',
          '',
          '[Source]',
          item.source_url || '',
        ].join('\n');
      };

      const openModal = (item) => {
        modalTitle.textContent = item.title;
        modalMeta.textContent = `${item.author || 'unknown'} · ${sourceLabel(sourceOf(item))}`;
        modalPrompt.textContent = item.prompt || '';
        modalSource.href = item.source_url || '#';
        modalCopy.onclick = async () => {
          await navigator.clipboard.writeText(item.prompt || '');
          modalCopy.textContent = 'Copied';
          setTimeout(() => (modalCopy.textContent = 'Copy Prompt'), 900);
        };
        modalCopyAi.onclick = async () => {
          await navigator.clipboard.writeText(buildAiTemplate(item));
          modalCopyAi.textContent = 'Copied';
          setTimeout(() => (modalCopyAi.textContent = 'Copy AI Template'), 900);
        };
        modal.classList.add('open');
      };

      const closeModal = () => modal.classList.remove('open');
      modalClose.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

      const renderSources = () => {
        sourcePanel.innerHTML = sourceChoices
          .map((s) => `<button class="chip ${state.source === s.value ? 'active' : ''}" data-source="${s.value}">${s.label}</button>`)
          .join('');
        sourcePanel.querySelectorAll('[data-source]').forEach((el) => {
          el.addEventListener('click', () => {
            state.source = el.getAttribute('data-source') || '';
            render();
            renderSources();
          });
        });
      };

      const render = () => {
        const term = state.q.trim().toLowerCase();
        const rows = state.items.filter((item) => {
          const bySource = !state.source || sourceOf(item) === state.source;
          const hay = `${item.title} ${(item.tags || []).join(' ')} ${item.prompt}`.toLowerCase();
          const byTerm = !term || hay.includes(term);
          return bySource && byTerm;
        });

        count.textContent = `Showing ${rows.length} / ${state.items.length}`;
        if (rows.length === 0) {
          grid.innerHTML = `<div class="empty">No matches found. Try clearing tag filters or changing the keyword.</div>`;
          return;
        }

        const blankCard = `
          <article class="card">
            <div class="title">Start from scratch</div>
            <div class="meta">Start from scratch</div>
            <div class="tags">
              <span class="tag">best-practices</span>
              <span class="tag">scratch</span>
            </div>
            <div class="prompt">Copy here to start from scratch with best practices.</div>
            <div class="actions">
              <button data-copy-blank="1">Copy Input Guide</button>
            </div>
          </article>
        `;

        grid.innerHTML = blankCard + rows.map((item) => {
          const text = (item.prompt || '').slice(0, 180);
          const preview = text + ((item.prompt || '').length > 180 ? '...' : '');
          return `
            <article class="card">
              <div class="title">${esc(item.title)}</div>
              <div class="meta">${esc(item.author || 'unknown')} · ${sourceLabel(sourceOf(item))}</div>
              <div class="tags">${(item.tags || []).map((t) => `<span class="tag">${esc(t)}</span>`).join('')}</div>
              <div class="prompt">${esc(preview)}</div>
              <div class="actions">
                <button data-preview="${encodeURIComponent(item.id)}">Preview</button>
                <button data-copy="${encodeURIComponent(item.prompt || '')}">Copy</button>
                <button data-copy-ai="${encodeURIComponent(item.id)}">Copy AI Template</button>
              </div>
            </article>
          `;
        }).join('');

        grid.querySelectorAll('button[data-copy-blank]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            await navigator.clipboard.writeText(buildBlankTemplate());
            btn.textContent = 'Copied';
            setTimeout(() => (btn.textContent = 'Copy Input Guide'), 900);
          });
        });

        grid.querySelectorAll('button[data-copy]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const value = decodeURIComponent(btn.getAttribute('data-copy') || '');
            await navigator.clipboard.writeText(value);
            btn.textContent = 'Copied';
            setTimeout(() => (btn.textContent = 'Copy'), 900);
          });
        });

        grid.querySelectorAll('button[data-preview]').forEach((btn) => {
          btn.addEventListener('click', () => {
            const id = decodeURIComponent(btn.getAttribute('data-preview') || '');
            const item = state.items.find((it) => it.id === id);
            if (item) openModal(item);
          });
        });
        grid.querySelectorAll('button[data-copy-ai]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const id = decodeURIComponent(btn.getAttribute('data-copy-ai') || '');
            const item = state.items.find((it) => it.id === id);
            if (!item) return;
            await navigator.clipboard.writeText(buildAiTemplate(item));
            btn.textContent = 'Copied';
            setTimeout(() => (btn.textContent = 'Copy AI Template'), 900);
          });
        });
      };

      q.addEventListener('input', () => { state.q = q.value; render(); });

      fetch('../index.json')
        .then((r) => r.json())
        .then((data) => {
          state.items = data;
          renderSources();
          render();
        })
        .catch((err) => {
          grid.innerHTML = `<div class="empty">Load failed: ${esc(String(err))}</div>`;
        });
    </script>
  </body>
</html>
